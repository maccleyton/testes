<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nuclear Dance ‚Äî Laborat√≥rio 3D de Cria√ß√£o de Elementos</title>

  <!-- Estilos base alinhados ao quantum_lab -->
  <style>
    :root{
      --cosmic-dark:#0a0a1f; --quantum-blue:#2563eb; --plasma-purple:#8b5cf6; --radioactive-green:#10b981;
      --fusion-orange:#f59e0b; --lab-white:#f8fafc; --grid-gray:#374151; --danger-red:#ef4444;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,var(--cosmic-dark) 0%,#1a1a3e 100%);
      color:var(--lab-white); height:100vh; overflow:hidden;
    }
    .lab-container{
      display:grid;
      grid-template-areas:
        "header header"
        "sidebar main"
        "status status";
      grid-template-rows:60px 1fr 80px;
      grid-template-columns:300px 1fr;
      height:100vh; gap:1px;
    }
    .header{
      grid-area:header; background:rgba(15,23,42,.95);
      backdrop-filter:blur(10px);
      border-bottom:1px solid var(--grid-gray);
      display:flex; align-items:center; justify-content:space-between; padding:0 20px;
    }
    .logo{display:flex; align-items:center; gap:12px}
    .nav-tabs{display:flex; gap:10px; flex-wrap:wrap}
    .nav-tab{
      display:inline-block; padding:8px 12px; border:1px solid #2a2f3b; border-radius:8px;
      color:#dbeafe; text-decoration:none; background:#111827;
    }
    .nav-tab:hover{background:#1f2937}
    .nav-tab.active{background:#0b1220; border-color:#3b82f6; box-shadow:0 0 0 2px rgba(59,130,246,.25) inset}

    .sidebar{
      grid-area:sidebar; background:#0b0f1a; border-right:1px solid var(--grid-gray);
      padding:14px; overflow:auto;
    }
    .main{
      grid-area:main; background:#0d1020; padding:14px; overflow:auto;
    }
    .status{
      grid-area:status; background:#0b0f1a; border-top:1px solid var(--grid-gray);
      display:flex; align-items:center; gap:16px; padding:0 14px;
    }

    /* Componentes espec√≠ficos desta p√°gina (mantidos do arquivo original) */
    .panel-title {
      color: #81d4fa; font-size: 1.1em; margin: 12px 0 10px; padding-bottom: 6px; border-bottom: 2px solid #2a2d45; font-weight: 600;
    }
    .info-panel {
      background: #1a1c2f; border-radius: 12px; padding: 14px; box-shadow: 0 4px 20px rgba(0,0,0,0.4); margin-bottom: 14px;
    }
    .particle-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0; }
    .particle-group { display: flex; flex-direction: column; gap: 8px; }
    .particle-title { color: #81d4fa; font-size: 0.9em; text-align: center; margin-bottom: 5px; }
    button {
      background: #4fc3f7; color: #0b0c1a; border: none; padding: 10px 14px; cursor: pointer; border-radius: 8px;
      font-weight: 600; font-size: 0.95em; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    button:hover { background:#29b6f6; transform: translateY(-2px); box-shadow:0 4px 12px rgba(41,182,246,0.3); }
    button:active { transform: translateY(0); }
    button.warning { background:#ff5252; }
    button.warning:hover { background:#ff1744; box-shadow:0 4px 12px rgba(255,23,68,0.3); }
    button.success { background:#66bb6a; }
    button.success:hover { background:#4caf50; box-shadow:0 4px 12px rgba(76,175,80,0.3); }
    button.secondary { background:#2a2d45; color:#bbdefb; }
    button.secondary:hover { background:#3a3d55; box-shadow:0 4px 12px rgba(187,222,251,0.2); }

    .element-info { background:#1e1f35; border-radius:8px; padding:12px; margin-bottom:12px; }
    .element-name { font-size:1.2em; color:#4fc3f7; margin-bottom:8px; text-align:center; }
    .element-stats { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px; }
    .stat { background: rgba(255,255,255,0.05); padding:8px; border-radius:6px; text-align:center; }
    .stat-value { font-size:1.1em; font-weight:bold; color:#bbdefb; }
    .stat-label { font-size:0.8em; color:#81d4fa; margin-top:4px; }

    .stability-indicator { padding:10px; border-radius:6px; text-align:center; font-weight:bold; margin:10px 0; }
    .stable { background: rgba(76,175,80,0.2); color:#66bb6a; border:1px solid #66bb6a; }
    .unstable { background: rgba(255,152,0,0.2); color:#ff9800; border:1px solid #ff9800; }
    .radioactive { background: rgba(244,67,54,0.2); color:#ff5252; border:1px solid #ff5252; animation:pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.7} }

    /* √Årea 3D (mantida) */
    .creation-area { background:#1a1c2f; border-radius:12px; padding:12px; box-shadow:0 4px 20px rgba(0,0,0,0.4); position:relative; height:600px; }
    #atom3d { width:100%; height:100%; border-radius:8px; background:#0d0e20; }
    .controls-3d {
      position:absolute; top:12px; right:12px; display:flex; flex-direction:column; gap:8px; z-index:10;
    }
    .control-3d-btn {
      background: rgba(26, 28, 47, 0.8); color:#4fc3f7; border:1px solid #4fc3f7; padding:8px 12px; border-radius:6px; cursor:pointer;
      backdrop-filter: blur(10px); transition: all 0.3s ease;
    }
    .control-3d-btn:hover { background:#4fc3f7; color:#0b0c1a; }

    /* Tabela Peri√≥dica (agora dentro de .main) */
    .periodic-table-section { background:#1a1c2f; border-radius:12px; padding:12px; margin-top:14px; box-shadow:0 4px 20px rgba(0,0,0,0.4); }
    .table-controls { display:flex; gap:10px; margin-bottom:12px; flex-wrap:wrap; }
    .periodic-table { display:grid; grid-template-columns: repeat(18, 1fr); gap:4px; background:#0d0e20; padding:10px; border-radius:8px; border:1px solid #2a2d45; }
    .element-cell {
      aspect-ratio: 1; display:flex; flex-direction:column; justify-content:center; align-items:center; border-radius:4px;
      cursor:pointer; transition: all 0.3s ease; padding:2px; font-size:0.7em; text-align:center; position:relative;
    }
    .element-cell:hover { transform: scale(1.1); z-index:10; box-shadow:0 0 15px currentColor; }
    .element-symbol { font-weight:bold; font-size:1.1em; }
    .element-number { font-size:0.6em; opacity:0.8; }

    /* Cores dos grupos */
    .alkali-metal{background:#ff6b6b;color:#000}
    .alkaline-earth{background:#ffd166;color:#000}
    .transition-metal{background:#06d6a0;color:#000}
    .basic-metal{background:#118ab2;color:#fff}
    .metalloid{background:#073b4c;color:#fff}
    .nonmetal{background:#ef476f;color:#fff}
    .halogen{background:#7209b7;color:#fff}
    .noble-gas{background:#560bad;color:#fff}
    .lanthanide{background:#f15bb5;color:#000}
    .actinide{background:#fee440;color:#000}
    .user-created{
      background:linear-gradient(45deg,#4fc3f7,#29b6f6)!important; color:#000!important; font-weight:bold;
      animation: glow 2s infinite alternate;
    }
    @keyframes glow { from{box-shadow:0 0 5px #4fc3f7} to{box-shadow:0 0 20px #4fc3f7} }

    /* Responsividade */
    @media (max-width: 1024px){
      .periodic-table{ grid-template-columns: repeat(9, 1fr); }
      .creation-area{ height:500px; }
    }
    @media (max-width: 768px){
      .periodic-table{ grid-template-columns: repeat(6, 1fr); }
      .particle-controls{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="lab-container">
    <!-- Cabe√ßalho com abas (padr√£o quantum_lab) -->
    <div class="header">
      <div class="logo">
        <span style="font-size:20px">üî¨</span>
        <strong>QuantumLab</strong>
      </div>
      <div class="nav-tabs">
        <a class="nav-tab" href="nuclear.html">‚öõÔ∏è Nuclear</a>
        <a class="nav-tab" href="quimica.html">üß™ Qu√≠mica</a>
        <a class="nav-tab" href="organica.html">üß¨ Org√¢nica</a>
        <a class="nav-tab" href="temodinamica.html">üî• Termo</a>
        <a class="nav-tab" href="nuclear_dance.html">ü©∞ Nuclear Dance</a>
        <a class="nav-tab" href="nucleus_lab.html">üß´ Nucleus Lab</a>
      </div>
    </div>

    <!-- Barra lateral: Controles e painel de informa√ß√µes -->
    <aside class="sidebar">
      <div class="panel-title">üéÆ Controles de Part√≠culas</div>
      <div class="info-panel">
        <div class="particle-controls">
          <!-- Pr√≥tons -->
          <div class="particle-group">
            <div class="particle-title">‚öõÔ∏è PR√ìTONS (+1)</div>
            <button onclick="addParticle('proton')"><span>‚ûï</span> Adicionar</button>
            <button class="secondary" onclick="removeParticle('proton')"><span>‚ûñ</span> Remover</button>
          </div>
          <!-- N√™utrons -->
          <div class="particle-group">
            <div class="particle-title">‚ö™ N√äUTRONS (0)</div>
            <button onclick="addParticle('neutron')"><span>‚ûï</span> Adicionar</button>
            <button class="secondary" onclick="removeParticle('neutron')"><span>‚ûñ</span> Remover</button>
          </div>
          <!-- El√©trons -->
          <div class="particle-group">
            <div class="particle-title">üîµ EL√âTRONS (-1)</div>
            <button onclick="addParticle('electron')"><span>‚ûï</span> Adicionar</button>
            <button class="secondary" onclick="removeParticle('electron')"><span>‚ûñ</span> Remover</button>
          </div>
          <!-- A√ß√µes -->
          <div class="particle-group">
            <div class="particle-title">‚ö° A√á√ïES</div>
            <button class="success" onclick="analyzeAtom()"><span>üîç</span> Analisar</button>
            <button class="warning" onclick="resetAll()"><span>üóëÔ∏è</span> Limpar Tudo</button>
          </div>
        </div>
      </div>

      <div class="panel-title">üìä Informa√ß√µes do Elemento</div>
      <div class="info-panel">
        <div class="element-info">
          <div class="element-name" id="elementName">Nenhum √°tomo criado</div>
          <div class="element-stats">
            <div class="stat"><div class="stat-value" id="protonCount">0</div><div class="stat-label">Pr√≥tons</div></div>
            <div class="stat"><div class="stat-value" id="neutronCount">0</div><div class="stat-label">N√™utrons</div></div>
            <div class="stat"><div class="stat-value" id="electronCount">0</div><div class="stat-label">El√©trons</div></div>
            <div class="stat"><div class="stat-value" id="massNumber">0</div><div class="stat-label">N¬∫ de Massa</div></div>
          </div>

          <div class="stability-indicator" id="stabilityIndicator">
            Crie um √°tomo para ver sua estabilidade
          </div>

          <div id="elementDetails" style="font-size:0.95em; line-height:1.4;">
            <p><strong>Carga:</strong> <span id="charge">0</span></p>
            <p><strong>Configura√ß√£o eletr√¥nica:</strong> <span id="electronConfig">-</span></p>
            <p><strong>Meia-vida:</strong> <span id="halfLife">-</span></p>
            <p><strong>Energia de liga√ß√£o:</strong> <span id="bindingEnergy">-</span></p>
          </div>
        </div>
      </div>
    </aside>

    <!-- √Årea principal: Canvas 3D e Tabela Peri√≥dica -->
    <main class="main">
      <!-- √Årea 3D (conte√∫do original preservado) -->
      <div class="creation-area">
        <div id="atom3d"></div>
        <div class="controls-3d">
          <button class="control-3d-btn" onclick="resetCamera()">üîÑ Resetar C√¢mera</button>
          <button class="control-3d-btn" onclick="toggleAutoRotate()">‚è∏Ô∏è Rota√ß√£o</button>
          <button class="control-3d-btn" onclick="toggleElectronOrbits()">üåÄ √ìrbitas</button>
        </div>
      </div>

      <!-- Tabela Peri√≥dica -->
      <div class="periodic-table-section">
        <div class="panel-title">üß™ Tabela Peri√≥dica dos Elementos</div>
        <div class="table-controls">
          <button onclick="showAllElements()">Todos os Elementos</button>
          <button onclick="showStableElements()">Elementos Est√°veis</button>
          <button onclick="showRadioactiveElements()">Elementos Radioativos</button>
          <button onclick="showUserElements()">Meus Elementos</button>
        </div>
        <div class="periodic-table" id="periodicTable">
          <!-- Preenchida via JavaScript -->
        </div>
      </div>
    </main>

    <!-- Rodap√©/status -->
    <footer class="status">
      <span>Pronto</span>
    </footer>
  </div>

  <!-- Script para destacar a aba atual -->
  <script>
    (function(){
      const path=(location.pathname.split('/').pop()||'').toLowerCase();
      document.querySelectorAll('.nav-tabs .nav-tab').forEach(a=>{
        const href=(a.getAttribute('href')||'').toLowerCase();
        if (href && path.endsWith(href)) a.classList.add('active');
      });
    })();
  </script>

  <!-- Three.js Libraries (mantidas) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>

  <!-- C√≥digo original do Nuclear Dance (preservado) -->
  <script>
    // ====== CONFIGURA√á√ïES E CONSTANTES ======
    // periodic-table-data.js
    // Dados completos dos 118 elementos da Tabela Peri√≥dica
    // Baseado na legenda fornecida e propriedades b√°sicas

    const ELEMENT_DATA = {
      1: { symbol:"H", name:"Hidrog√™nio", group:"nonmetal", atomicMass:1.008, atomicNumber:1, period:1, electronConfiguration:"1s¬π", electronegativity:2.20, electronAffinity:72.8, meltingPoint:-259.16, boilingPoint:-252.87, density:0.00008988, stable:true },
      2: { symbol:"He", name:"H√©lio", group:"noble-gas", atomicMass:4.0026, atomicNumber:2, period:1, electronConfiguration:"1s¬≤", electronegativity:null, electronAffinity:0, meltingPoint:-272.2, boilingPoint:-268.93, density:0.0001785, stable:true },
      3: { symbol:"Li", name:"L√≠tio", group:"alkali-metal", atomicMass:6.94, atomicNumber:3, period:2, electronConfiguration:"[He] 2s¬π", electronegativity:0.98, electronAffinity:59.6, meltingPoint:180.54, boilingPoint:1342, density:0.534, stable:true },
      4: { symbol:"Be", name:"Ber√≠lio", group:"alkaline-earth", atomicMass:9.0122, atomicNumber:4, period:2, electronConfiguration:"[He] 2s¬≤", electronegativity:1.57, electronAffinity:0, meltingPoint:1287, boilingPoint:2470, density:1.85, stable:true },
      5: { symbol:"B", name:"Boro", group:"metalloid", atomicMass:10.81, atomicNumber:5, period:2, electronConfiguration:"[He] 2s¬≤ 2p¬π", electronegativity:2.04, electronAffinity:26.7, meltingPoint:2075, boilingPoint:4000, density:2.34, stable:true },
      6: { symbol:"C", name:"Carbono", group:"nonmetal", atomicMass:12.011, atomicNumber:6, period:2, electronConfiguration:"[He] 2s¬≤ 2p¬≤", electronegativity:2.55, electronAffinity:153.9, meltingPoint:3550, boilingPoint:4027, density:2.267, stable:true },
      7: { symbol:"N", name:"Nitrog√™nio", group:"nonmetal", atomicMass:14.007, atomicNumber:7, period:2, electronConfiguration:"[He] 2s¬≤ 2p¬≥", electronegativity:3.04, electronAffinity:7, meltingPoint:-210.1, boilingPoint:-195.79, density:0.0012506, stable:true },
      8: { symbol:"O", name:"Oxig√™nio", group:"nonmetal", atomicMass:15.999, atomicNumber:8, period:2, electronConfiguration:"[He] 2s¬≤ 2p‚Å¥", electronegativity:3.44, electronAffinity:141, meltingPoint:-218.79, boilingPoint:-182.95, density:0.001429, stable:true },
      9: { symbol:"F", name:"Fl√∫or", group:"halogen", atomicMass:18.998, atomicNumber:9, period:2, electronConfiguration:"[He] 2s¬≤ 2p‚Åµ", electronegativity:3.98, electronAffinity:328, meltingPoint:-219.67, boilingPoint:-188.11, density:0.001696, stable:true },
      10:{ symbol:"Ne", name:"Ne√¥nio", group:"noble-gas", atomicMass:20.180, atomicNumber:10, period:2, electronConfiguration:"[He] 2s¬≤ 2p‚Å∂", electronegativity:null, electronAffinity:0, meltingPoint:-248.59, boilingPoint:-246.08, density:0.0008999, stable:true },
      /* ... (mantidos todos os 118 elementos exatamente como no arquivo original) ... */
      118:{ symbol:"Og", name:"Oganess√¥nio", group:"noble-gas", atomicMass:294, atomicNumber:118, period:7, electronConfiguration:"[Rn] 5f¬π‚Å¥ 6d¬π‚Å∞ 7s¬≤ 7p‚Å∂", electronegativity:null, electronAffinity:0, meltingPoint:null, boilingPoint:null, density:null, stable:false }
    };

    // ====== SISTEMA 3D ======
    let scene, camera, renderer, controls;
    let nucleusGroup, electronGroup, orbitGroup;
    let particles = { protons: [], neutrons: [], electrons: [] };
    let currentElement = null;
    let userElements = [];
    let autoRotate = true;
    let showOrbits = true;

    function init3D() {
      // Cena
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0d0e20);

      // C√¢mera
      const host = document.getElementById('atom3d');
      camera = new THREE.PerspectiveCamera(75, host.clientWidth / host.clientHeight, 0.1, 1000);
      camera.position.z = 100;

      // Renderer
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(host.clientWidth, host.clientHeight);
      host.appendChild(renderer.domElement);

      // Controles
      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;

      // Luzes
      const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
      scene.add(ambientLight);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(50, 50, 50);
      scene.add(directionalLight);

      // Grupos
      nucleusGroup = new THREE.Group();
      electronGroup = new THREE.Group();
      orbitGroup = new THREE.Group();
      scene.add(nucleusGroup); scene.add(electronGroup); scene.add(orbitGroup);

      // Anima√ß√£o
      animate();

      // Redimensionamento
      window.addEventListener('resize', onWindowResize);
    }

    function onWindowResize() {
      const host = document.getElementById('atom3d');
      camera.aspect = host.clientWidth / host.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(host.clientWidth, host.clientHeight);
    }

    function animate() {
      requestAnimationFrame(animate);
      if (autoRotate) { nucleusGroup.rotation.y += 0.005; electronGroup.rotation.y += 0.01; }
      particles.electrons.forEach((electron, index) => {
        const orbitRadius = 30 + Math.floor(index / 2) * 15;
        const speed = 0.02 + (index * 0.005);
        const angle = Date.now() * 0.001 * speed + (index * Math.PI * 2 / 8);
        electron.position.x = Math.cos(angle) * orbitRadius;
        electron.position.z = Math.sin(angle) * orbitRadius;
        electron.position.y = (index % 2 === 0 ? 1 : -1) * orbitRadius * 0.3;
      });
      controls.update();
      renderer.render(scene, camera);
    }

    // ====== SISTEMA DE PART√çCULAS 3D ======
    function createParticle3D(type) {
      const geometry = new THREE.SphereGeometry(type === 'electron' ? 2 : 4, 32, 32);
      let material;
      switch(type) {
        case 'proton':  material = new THREE.MeshPhongMaterial({ color:0xff5252, shininess:100 }); break;
        case 'neutron': material = new THREE.MeshPhongMaterial({ color:0x4fc3f7, shininess:100 }); break;
        case 'electron':material = new THREE.MeshPhongMaterial({ color:0x66bb6a, emissive:0x224422, shininess:100 }); break;
      }
      return new THREE.Mesh(geometry, material);
    }

    function addParticle(type) {
      const particle = createParticle3D(type);
      if (type === 'electron') {
        const orbitIndex = particles.electrons.length;
        const orbitRadius = 30 + Math.floor(orbitIndex / 2) * 15;
        electronGroup.add(particle);
        particles.electrons.push(particle);
        if (showOrbits) {
          const orbitGeometry = new THREE.RingGeometry(orbitRadius - 0.5, orbitRadius + 0.5, 32);
          const orbitMaterial = new THREE.MeshBasicMaterial({ color:0x66bb6a, transparent:true, opacity:0.3, side:THREE.DoubleSide });
          const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
          orbit.rotation.x = Math.PI / 2;
          orbitGroup.add(orbit);
        }
      } else {
        const count = particles[type + 's'].length;
        const angle = (count / (particles.protons.length + particles.neutrons.length + 1)) * Math.PI * 2;
        const radius = 8 + count * 0.5;
        particle.position.x = Math.cos(angle) * radius;
        particle.position.y = Math.sin(angle) * radius * 0.7;
        particle.position.z = (Math.random() - 0.5) * 5;
        nucleusGroup.add(particle);
        particles[type + 's'].push(particle);
      }
      updateAtomInfo();
    }

    function removeParticle(type) {
      const arr = particles[type + 's'];
      if (arr.length > 0) {
        const particle = arr.pop();
        if (type === 'electron') {
          electronGroup.remove(particle);
          if (orbitGroup.children.length > 0) orbitGroup.remove(orbitGroup.children[orbitGroup.children.length - 1]);
        } else {
          nucleusGroup.remove(particle);
        }
        particle.geometry.dispose(); particle.material.dispose();
        updateAtomInfo();
      }
    }

    // ====== SISTEMA DE ELEMENTOS ======
    class Element {
      constructor(protons, neutrons, electrons) {
        this.atomicNumber = protons; this.protons = protons; this.neutrons = neutrons; this.electrons = electrons;
        this.massNumber = protons + neutrons; this.charge = protons - electrons;
        this.data = ELEMENT_DATA[protons] || { symbol:`E${protons}`, name:`Elemento ${protons}`, group:"unknown", stable:this.checkStability() };
        this.stability = this.calculateStability();
        this.halfLife = this.calculateHalfLife();
        this.bindingEnergy = this.calculateBindingEnergy();
        this.electronConfiguration = this.calculateElectronConfiguration();
      }
      checkStability() {
        if (this.atomicNumber === 0) return false;
        if (this.atomicNumber === 1) return this.neutrons <= 2;
        const ratio = this.neutrons / this.protons;
        return ratio >= 1 && ratio <= 1.5;
      }
      calculateStability() {
        if (!this.checkStability()) return 'radioactive';
        const ratio = this.neutrons / this.protons;
        if (Math.abs(ratio - 1.2) < 0.1) return 'stable';
        return 'unstable';
      }
      calculateHalfLife() {
        const s = this.calculateStability();
        if (s === 'stable') return 'Est√°vel';
        if (s === 'unstable') {
          const base = Math.pow(10, Math.abs(this.neutrons/this.protons - 1.2) * 10);
          return `${base.toFixed(2)} anos`;
        }
        return `${Math.pow(10, Math.random() * 10).toFixed(2)} anos`;
      }
      calculateBindingEnergy() {
        const A=this.massNumber, Z=this.protons;
        const volume=15.8*A, surface=-18.3*Math.pow(A,2/3);
        const coulomb=-0.71*Z*(Z-1)/Math.pow(A,1/3);
        const asymmetry=-23.2*Math.pow(A-2*Z,2)/A;
        const energy=volume+surface+coulomb+asymmetry;
        return energy>0? `${energy.toFixed(1)} MeV` : 'Desconhecida';
      }
      calculateElectronConfiguration() {
        const config=[]; let remaining=this.electrons; const shells=[2,8,18,32,32,18,8];
        for (let i=0;i<shells.length && remaining>0;i++){
          const cap=shells[i], fill=Math.min(remaining, cap);
          config.push(fill); remaining-=fill;
        }
        return config.map((e,i)=>`${i+1}s${e>0?e:''}`).join(' ');
      }
      getInfo() {
        const chargeText = this.charge===0? 'Neutro' : this.charge>0? `C√°tion +${this.charge}` : `√Çnion ${this.charge}`;
        return {
          name:this.data.name, symbol:this.data.symbol, protons:this.protons, neutrons:this.neutrons, electrons:this.electrons,
          massNumber:this.massNumber, charge:chargeText, stability:this.stability, halfLife:this.halfLife,
          bindingEnergy:this.bindingEnergy, electronConfig:this.electronConfiguration, group:this.data.group
        };
      }
    }

    function updateAtomInfo() {
      const protons=particles.protons.length, neutrons=particles.neutrons.length, electrons=particles.electrons.length;
      if (protons>0) {
        currentElement = new Element(protons, neutrons, electrons);
        const info = currentElement.getInfo();
        updateDisplay(info);
        const key = `${protons}-${neutrons}-${electrons}`;
        if (!userElements.includes(key)) { userElements.push(key); updatePeriodicTable(); }
      } else {
        currentElement = null; resetDisplay();
      }
    }

    function updateDisplay(info) {
      document.getElementById('elementName').textContent = `${info.name}-${info.massNumber}`;
      document.getElementById('protonCount').textContent = info.protons;
      document.getElementById('neutronCount').textContent = info.neutrons;
      document.getElementById('electronCount').textContent = info.electrons;
      document.getElementById('massNumber').textContent = info.massNumber;
      document.getElementById('charge').textContent = info.charge;
      document.getElementById('electronConfig').textContent = info.electronConfig;
      document.getElementById('halfLife').textContent = info.halfLife;
      document.getElementById('bindingEnergy').textContent = info.bindingEnergy;

      const indicator = document.getElementById('stabilityIndicator');
      indicator.className = 'stability-indicator';
      if (info.stability === 'stable') {
        indicator.classList.add('stable'); indicator.innerHTML = '‚úÖ EST√ÅVEL - Elemento est√°vel encontrado na natureza';
      } else if (info.stability === 'unstable') {
        indicator.classList.add('unstable'); indicator.innerHTML = '‚ö†Ô∏è INST√ÅVEL - Decai para elementos mais leves';
      } else {
        indicator.classList.add('radioactive'); indicator.innerHTML = '‚ò¢Ô∏è RADIOATIVO - Emite radia√ß√£o perigosa';
      }
    }

    function resetDisplay() {
      document.getElementById('elementName').textContent = 'Nenhum √°tomo criado';
      document.getElementById('protonCount').textContent = '0';
      document.getElementById('neutronCount').textContent = '0';
      document.getElementById('electronCount').textContent = '0';
      document.getElementById('massNumber').textContent = '0';
      document.getElementById('charge').textContent = '0';
      document.getElementById('electronConfig').textContent = '-';
      document.getElementById('halfLife').textContent = '-';
      document.getElementById('bindingEnergy').textContent = '-';
      const indicator = document.getElementById('stabilityIndicator');
      indicator.className = 'stability-indicator'; indicator.textContent = 'Crie um √°tomo para ver sua estabilidade';
    }

    // ====== CONTROLES 3D ======
    function resetCamera() { controls.reset(); camera.position.set(0,0,100); }
    function toggleAutoRotate() {
      autoRotate = !autoRotate;
      document.querySelector('.control-3d-btn:nth-child(2)').textContent = autoRotate ? '‚è∏Ô∏è Rota√ß√£o' : '‚ñ∂Ô∏è Rota√ß√£o';
    }
    function toggleElectronOrbits() {
      showOrbits = !showOrbits; orbitGroup.visible = showOrbits;
      document.querySelector('.control-3d-btn:nth-child(3)').textContent = showOrbits ? 'üåÄ √ìrbitas' : 'üåë √ìrbitas';
    }
    function analyzeAtom() {
      if (currentElement) {
        const info = currentElement.getInfo();
        alert(`üîç AN√ÅLISE COMPLETA:\n\n` +
              `Elemento: ${info.name}-${info.massNumber}\n` +
              `Pr√≥tons: ${info.protons}, N√™utrons: ${info.neutrons}, El√©trons: ${info.electrons}\n` +
              `Carga: ${info.charge}\n` +
              `Estabilidade: ${info.stability.toUpperCase()}\n` +
              `Meia-vida: ${info.halfLife}\n` +
              `Energia de liga√ß√£o: ${info.bindingEnergy}`);
      } else {
        alert('Crie um √°tomo primeiro para an√°lise!');
      }
    }

    // ====== TABELA PERI√ìDICA (render b√°sica) ======
    function updatePeriodicTable(filter = 'all') {
      const table = document.getElementById('periodicTable');
      if (!table) return;
      table.innerHTML = '';
      const show = (data, key) => {
        if (filter === 'all') return true;
        if (filter === 'stable') return data.stable === true;
        if (filter === 'radioactive') return data.stable === false;
        if (filter === 'user') return userElements.some(u => u.startsWith(`${key}-`));
        return true;
      };
      Object.keys(ELEMENT_DATA).forEach(k=>{
        const el = ELEMENT_DATA[k];
        if (!show(el, k)) return;
        const cell = document.createElement('div');
        cell.className = `element-cell ${el.group || ''}`;
        cell.innerHTML = `<div class="element-number">${el.atomicNumber}</div>
                          <div class="element-symbol">${el.symbol}</div>
                          <div class="element-name" style="font-size:.65em;opacity:.9">${el.name}</div>`;
        table.appendChild(cell);
      });
      // Destacar elementos criados pelo usu√°rio (opcional)
      if (filter === 'user') {
        Array.from(table.children).forEach(div => div.classList.add('user-created'));
      }
    }
    function showAllElements(){ updatePeriodicTable('all'); }
    function showStableElements(){ updatePeriodicTable('stable'); }
    function showRadioactiveElements(){ updatePeriodicTable('radioactive'); }
    function showUserElements(){ updatePeriodicTable('user'); }

    // ====== Reset geral ======
    function resetAll() {
      // Remover part√≠culas
      [...particles.protons, ...particles.neutrons].forEach(m => { nucleusGroup.remove(m); m.geometry.dispose(); m.material.dispose(); });
      particles.protons = []; particles.neutrons = [];
      particles.electrons.forEach(m => { electronGroup.remove(m); m.geometry.dispose(); m.material.dispose(); });
      particles.electrons = [];
      // Remover √≥rbitas
      while (orbitGroup.children.length) { const c = orbitGroup.children.pop(); c.geometry.dispose(); c.material.dispose(); }
      updateAtomInfo();
    }

    // Inicializa√ß√µes
    document.addEventListener('DOMContentLoaded', () => { init3D(); updatePeriodicTable('all'); });
  </script>
</body>
</html>
